<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Metadata &mdash; Parthenon  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Prolongation and Restriction Operations" href="refinement_operations.html" />
    <link rel="prev" title="Containers" href="containers.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Parthenon
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../README.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../amr.html">Adaptive Mesh Refinement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../boundary_communication.html">Boundary communication-in-one concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../boundary_communication.html#sparse-boundary-communication">Sparse boundary communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../boundary_conditions.html">Boundary Conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building.html">Building Parthenon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts_lite.html">C++11 Style Concepts Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../constants.html">Parthenon Built-in Physical Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coordinates.html">Coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Parthenon developer guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver.html">Application Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inputs.html">Input Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../instrumentation.html">Performance Instrumentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrators.html">Integrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../load_balancing.html">Load Balancing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nested_par_for.html">Nested Parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../outputs.html">Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parthenon_arrays.html">Parthenon Set-Dimensional Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parthenon_arrays.html#parthenon-arbitrary-dimensional-arrays">Parthenon Arbitrary-Dimensional Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parthenon_manager.html">Parthenon Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../particles.html">Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reductions.html">Task-based reductions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../solvers.html">Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sphinx-doc.html">How to Use Sphinx for Writing Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tasks.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tests.html">How to add tests to Parthenon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../weak_scaling.html">Running a Weak Scaling Test in Parthenon</a></li>
<li class="toctree-l1"><a class="reference internal" href="boundary.html">Boundary related classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">Containers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Metadata</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependency-management">Dependency Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variable-topology">Variable Topology</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variable-behaviors">Variable Behaviors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#output">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tensor-properties-and-boundaries">Tensor properties and boundaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="#independent-derived">Independent/Derived</a></li>
<li class="toctree-l2"><a class="reference internal" href="#communication">Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ghost-zones-communication-and-fluxes">Ghost Zones, Communication, and Fluxes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requesting-or-excluding-flux-variables-from-searches">Requesting or excluding flux variables from searches</a></li>
<li class="toctree-l2"><a class="reference internal" href="#application-metadata-flags">Application Metadata Flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flag-collections">Flag Collections</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="refinement_operations.html">Prolongation and Restriction Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparse.html">Sparse implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="state.html">State Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mesh/domain.html">Domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mesh/mesh.html">Mesh</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Parthenon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Metadata</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/src/interface/metadata.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="metadata">
<span id="id1"></span><h1>Metadata<a class="headerlink" href="#metadata" title="Link to this heading"></a></h1>
<p>Variables can be tagged with a variety of <code class="docutils literal notranslate"><span class="pre">MetadataFlag</span></code> values. These
flags primarily allow an application to tell Parthenon to apply certain
behaviors to each field.</p>
<section id="dependency-management">
<h2>Dependency Management<a class="headerlink" href="#dependency-management" title="Link to this heading"></a></h2>
<p>Several packages may add variables of the same name. These metadata
flags tell <code class="docutils literal notranslate"><span class="pre">Parthenon</span></code> how to resolve conflicts.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Private</span></code>: private metadata means a variable is package specific.
The package name is prepended to the variable name, like a namespace.
Two different variables can have the same name if they live in
different packages.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Provides</span></code>: variables with this metadata are shared, and demand
they be the only ones to provide a variable. The metadata of these
variables takes priority. If two packages provide the same variable
with the Provides metadata, an error is raised at runtime. Provides
is on by default unless overriden by another flag.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Requires</span></code>: variables with this metadata flag are not added by a
package. The package simply declares it expects the variable to exist
and if it doesn’t, an error is raised.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Overridable</span></code>: Variables with this metadata flag are provided by
the package that registers them unless another package provides said
variable (with the Provides flag), in which case, that other package
determines what happens to that variable. If two packages request an
Overridable variable, but it is not provided, it’s undefined
behaviour and Parthenon warns as such.</p></li>
</ul>
</section>
<section id="variable-topology">
<h2>Variable Topology<a class="headerlink" href="#variable-topology" title="Link to this heading"></a></h2>
<p>Topology essentially specifies on which place on the finite volume grid
the variable is defined. These fields specify what index space the
variable is allocated over. E.g. <code class="docutils literal notranslate"><span class="pre">Metadata::Cell</span></code> specifies that the
variable is allocated over the cell index space in each block.</p>
<p>The following fields specify the topology of the variable, and are
mutually exclusive:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::None</span></code>: no topology specified. The variable could be
anywhere, or location is not a meaningful concept for this variable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::Cell</span></code>: The variable is defined on cell centers. The
variable is likely volume-averaged.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::Face</span></code>: The variable is defined on cell faces. The
variable is likely area-averaged.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::Edge</span></code>: The variable is defined on cell edges. The
variable is likely length-averaged.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::Node</span></code>: The variable is defined at nodes, i.e.,
cell-corners. The variable might be volume-averaged, or defined
pointwise.</p></li>
</ul>
</section>
<section id="variable-behaviors">
<h2>Variable Behaviors<a class="headerlink" href="#variable-behaviors" title="Link to this heading"></a></h2>
<p>These flags can be used to tell an application code how to treat a
variable in relation to the problem.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::Advected</span></code> implies a variable is advected with the flow
of another variable, e.g., a velocity.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::Conserved</span></code> implies a variable obeys a conservation law.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::Intensive</span></code> implies that the value of a variable does not
scale with volume.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::Sparse</span></code> implies that the variable is sparse and hence it
may not be allocated on all blocks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::ForceAllocOnNewBlocks</span></code> forces allocation of a sparse variable
on any new <code class="docutils literal notranslate"><span class="pre">MeshBlock</span></code> that may be created through AMR or load
balancing.</p></li>
</ul>
</section>
<section id="output">
<h2>Output<a class="headerlink" href="#output" title="Link to this heading"></a></h2>
<p>These flags specify how a variable interacts with I/O. Enable them to
enable output properties.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::Restart</span></code> implies a variable is required in restart files</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Metadata::CoordinatesVec</span></code> implies a variable should be used to</dt><dd><p>describe coordinate positions of nodes. Must be a node-centered
variable with 3 components.</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="tensor-properties-and-boundaries">
<h2>Tensor properties and boundaries<a class="headerlink" href="#tensor-properties-and-boundaries" title="Link to this heading"></a></h2>
<p>For multidimensional variables, these flags specify how to treat the
individual components at boundaries. For concreteness, we will discuss
reflecting boundaries. But this may apply more broadly. A variable with
no flag set is assumed to be a <em>Scalar</em>. Scalars obey <a class="reference external" href="https://en.wikipedia.org/wiki/Dirichlet_boundary_condition">Dirichlet
boundary
conditions</a>
at reflecting boundaries and are set to a constant value. The following
flags are mutually exclusive.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::Vector</span></code> implies the variable transforms as a <em>vector</em> at
reflecting boundaries. And so i-th component is flipped for a
boundary in the i-th direction.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::Tensor</span></code> is the generalization of the vector boundary
condition, but for tensor quantities.</p></li>
</ul>
</section>
<section id="independent-derived">
<h2>Independent/Derived<a class="headerlink" href="#independent-derived" title="Link to this heading"></a></h2>
<p>These flags specify to an application code, and the infrastructure,
whether or not a variable is part of independent state. Derived
quantities can be calculated from the set of independent quantities,
while independent quantities cannot. The following flags are mutually
exclusive and required. All variables should be either independent or
derived.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::Independent</span></code> implies the variable is part of independent
state. In particular, implies data is in restart files and is
prolongated/restricted during remeshing. Buffers for a coarse grid
are allocated for independent variables.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::Derived</span></code> implies the variable can be calculated, given
the independent state. This is the default.</p></li>
</ul>
</section>
<section id="communication">
<h2>Communication<a class="headerlink" href="#communication" title="Link to this heading"></a></h2>
<p>These flags specify both how ghost zones are treated, and whether
variables are copied or not in multiple stages.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::OneCopy</span></code> are shared between stages. They are only ever
allocated once.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::FillGhost</span></code> specifies that ghost zones for this variable
must be filled via communication or boundary conditions. This is not
always required. <code class="docutils literal notranslate"><span class="pre">OneCopy</span></code> variables, for example, may not need
this.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Metadata::Flux</span></code> specifies that elements shared with neighbor blocks
at coarse-fine boundaries are communicated  and corrected during flux
correction.</p></li>
</ul>
</section>
<section id="ghost-zones-communication-and-fluxes">
<h2>Ghost Zones, Communication, and Fluxes<a class="headerlink" href="#ghost-zones-communication-and-fluxes" title="Link to this heading"></a></h2>
<p>Depending on a combination of flags, extra communication buffers and
classes may be allocated. The behaviours are the following:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">Metadata::FillGhosts</span></code> is set, boundary conditions data is set,
MPI communication buffers are allocated, and buffers for a coarse
grid are allocated. These buffers are <em>one-copy</em>, meaning they are
shared between all instances of a variable in all <code class="docutils literal notranslate"><span class="pre">Containers</span></code> in a
<code class="docutils literal notranslate"><span class="pre">DataCollection</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Metadata::WithFluxes</span></code> is set, a new one-copy variable with the</p></li>
</ul>
<blockquote>
<div><p>correct topological type for a flux in the generalized Stokes theorem
sense (e.g. if the <code class="docutils literal notranslate"><span class="pre">WithFluxes</span></code> variable has <code class="docutils literal notranslate"><span class="pre">Metadata::Cell</span></code>
set the new variable will have <code class="docutils literal notranslate"><span class="pre">Metadata::Face</span></code>) will be created in
the package with the name <code class="docutils literal notranslate"><span class="pre">bnd_flux::name_of_original_variable</span></code> and
<code class="docutils literal notranslate"><span class="pre">Metadata::Flux</span></code> and <code class="docutils literal notranslate"><span class="pre">Metadata::OneCopy</span></code>. When creating packs that
include fluxes, the new flux field will be included in the flux portion
of the pack if the parent field is in the pack.</p>
</div></blockquote>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">Metadata::Flux</span></code> is set, this field is exchanged on shared elements
across fine-coarse boundaries when the flux correction tasks are called.
<em>If ``Metadata::Flux`` and ``Metadata::Face`` are both set, the underlying
array that stores the field will be one smaller than a regular face field
in its x1, x2, and x3 dimensions so that it has the same shape in the
final three dimensions as a cell centered field. This is to align the memory
of cell variables and their fluxes, both for performance reasons and to
ensure backward compatibilty for downstream codes.</em></p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Metadata::ForceRemeshComm</span></code> is set, the variable is communicated
between ranks during remeshing. Variables with
<code class="docutils literal notranslate"><span class="pre">Metadata::Independent</span></code> and/or <code class="docutils literal notranslate"><span class="pre">Metadata::FillGhost</span></code> are also
automatically communicated when a block is communicated from one
process to another. Other variables <strong>are not</strong> communicated across
ranks, since the Parthenon model assumes that all fields are either
<code class="docutils literal notranslate"><span class="pre">Independent</span></code> or <code class="docutils literal notranslate"><span class="pre">Derived</span></code> and that the <code class="docutils literal notranslate"><span class="pre">Derived</span></code> fields can be
reconstructed from only the <code class="docutils literal notranslate"><span class="pre">Independent</span></code> fields by calling
<code class="docutils literal notranslate"><span class="pre">FillDerived</span></code>. Nevertheless, it is sometimes useful to pass certain
<code class="docutils literal notranslate"><span class="pre">Derived</span></code> fields between ranks during remeshing rather than rebuild
them (e.g. the initial guesses for a root find that may converge
slowly or not at all without a good initial guess). <em>This flag should
be used with caution, since it has the possibility the possibility to
mask errors in the ``FillDerived`` implementation in downstream
codes.</em></p></li>
</ul>
</section>
<section id="requesting-or-excluding-flux-variables-from-searches">
<h2>Requesting or excluding flux variables from searches<a class="headerlink" href="#requesting-or-excluding-flux-variables-from-searches" title="Link to this heading"></a></h2>
<p>As discussed above, fluxes are themselves <code class="docutils literal notranslate"><span class="pre">Metadata::OneCopy</span></code>
variables. A flux variable will have <code class="docutils literal notranslate"><span class="pre">Metadata::Flux</span></code> flag
set. Several functions allow one to request variables by various
properties such as name, unique ID, or metadata flag. These functions
often take an optional enum argument <code class="docutils literal notranslate"><span class="pre">FluxRequest</span></code>. This variable
can take on the values <code class="docutils literal notranslate"><span class="pre">FluxRequest::Any</span></code>, <code class="docutils literal notranslate"><span class="pre">FluxRequest::NoFlux</span></code>,
and <code class="docutils literal notranslate"><span class="pre">FluxRequest::OnlyFlux</span></code>. The default is
<code class="docutils literal notranslate"><span class="pre">FluxRequest::NoFlux</span></code>. Specifying <code class="docutils literal notranslate"><span class="pre">FluxRequest::NoFlux</span></code> enforces
that no variables returned by the search will be flux
variables. Specifying <code class="docutils literal notranslate"><span class="pre">FluxRequest::OnlyFlux</span></code> specifically pulls out
the flux variable <strong>associated</strong> with the variable
requested. <code class="docutils literal notranslate"><span class="pre">FluxRequest::Any</span></code> does not modify search parameters. You
will get flux or non-flux variables, and variable associations will be
ignored.</p>
</section>
<section id="application-metadata-flags">
<h2>Application Metadata Flags<a class="headerlink" href="#application-metadata-flags" title="Link to this heading"></a></h2>
<p>Applications can allocate their own flags by calling
<code class="docutils literal notranslate"><span class="pre">Metadata::AllocateNewFlag(&quot;FlagName&quot;)</span></code>. For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">parthenon</span><span class="o">::</span><span class="n">Metadata</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="n">parthenon</span><span class="o">::</span><span class="n">MetadataFlag</span><span class="p">;</span>

<span class="n">MetadataFlag</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">my_app_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Metadata</span><span class="o">::</span><span class="n">AllocateNewFlag</span><span class="p">(</span><span class="s">&quot;MyAppFlag&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>These can be used in all the same contexts that the built-in metadata
flags are used. Parthenon will not interpret them in any way - it’s up
to the application to interpret them.</p>
<p>A user-registered metadata flag can be retrieved from the
infrastructure by, for example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">MetadataFlag</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">my_app_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Metadata</span><span class="o">::</span><span class="n">GetUserFlag</span><span class="p">(</span><span class="s">&quot;MyAppFlag&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that this call will return an error if a flag is requested that
hasn’t been registered.</p>
</section>
<section id="flag-collections">
<h2>Flag Collections<a class="headerlink" href="#flag-collections" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Metadata::FlagCollection</span></code> class provides a way to express a desire for
a collection of <code class="docutils literal notranslate"><span class="pre">Parthenon</span></code> fields that satisfy some combinations of
<code class="docutils literal notranslate"><span class="pre">MetadataFlag</span></code>s. In particular, a <code class="docutils literal notranslate"><span class="pre">FlagCollection</span></code> specifies for a
desire for fields with:</p>
<ul class="simple">
<li><p>At least <strong>one</strong> of the flags in the <code class="docutils literal notranslate"><span class="pre">Unions</span></code> property of the <code class="docutils literal notranslate"><span class="pre">FlagCollection</span></code></p></li>
<li><p><strong>All</strong> of the flags in the <code class="docutils literal notranslate"><span class="pre">Intersections</span></code> property of the <code class="docutils literal notranslate"><span class="pre">FlagCollection</span></code></p></li>
<li><p><strong>None</strong> of the flags in the <code class="docutils literal notranslate"><span class="pre">Exclusions</span></code> property of the <code class="docutils literal notranslate"><span class="pre">FlagCollection</span></code></p></li>
</ul>
<p>Flag collections can be constructed from a C++
standard library container of <code class="docutils literal notranslate"><span class="pre">MetadataFlag</span></code> objects, or simply a
comma separated list of them. For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">parthenon</span><span class="o">::</span><span class="n">Metadata</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="n">parthenon</span><span class="o">::</span><span class="n">MetadataFlag</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="n">FS_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Metadata</span><span class="o">::</span><span class="n">FlagCollection</span>
<span class="c1">// Constructor from a container</span>
<span class="n">FS_t</span><span class="w"> </span><span class="n">set1</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">MetadataFlag</span><span class="o">&gt;</span><span class="p">{</span><span class="n">Metadata</span><span class="o">::</span><span class="n">Cell</span><span class="p">,</span><span class="w"> </span><span class="n">Metadata</span><span class="o">::</span><span class="n">Face</span><span class="p">});</span>
<span class="c1">// Constructor from a comma separated list</span>
<span class="n">FS_t</span><span class="w"> </span><span class="nf">set2</span><span class="p">(</span><span class="n">Metadata</span><span class="o">::</span><span class="n">Requires</span><span class="p">,</span><span class="w"> </span><span class="n">Metadata</span><span class="o">::</span><span class="n">Overridable</span><span class="p">);</span>
</pre></div>
</div>
<p>By default constructor arguments go into the <code class="docutils literal notranslate"><span class="pre">Intersections</span></code> property
of the <code class="docutils literal notranslate"><span class="pre">FlagCollection</span></code>. However, if a container is passed into the
constructor, you can also pass in an optional boolean flag to specify
whether or not you want to match <strong>any</strong> flags instead of <strong>all</strong>
flag. This adds the constructor arguments to the <code class="docutils literal notranslate"><span class="pre">Unions</span></code>
property of the <code class="docutils literal notranslate"><span class="pre">FlagCollection</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Implicit construction from a container, which</span>
<span class="c1">// requests EITHER the following flags instead of BOTH</span>
<span class="n">FS_t</span><span class="w"> </span><span class="nf">set2</span><span class="p">({</span><span class="n">Metadata</span><span class="o">::</span><span class="n">Independent</span><span class="p">,</span><span class="w"> </span><span class="n">Metadata</span><span class="o">::</span><span class="n">FillGhost</span><span class="p">},</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
<p>The flags contained in the <code class="docutils literal notranslate"><span class="pre">Unions</span></code>, <code class="docutils literal notranslate"><span class="pre">Intersections</span></code>, and
<code class="docutils literal notranslate"><span class="pre">Exclusions</span></code> properties of the <code class="docutils literal notranslate"><span class="pre">FlagCollection</span></code> can be extracted via
equivalently named accessors, which return a <code class="docutils literal notranslate"><span class="pre">std::set</span></code>. For
example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">MetadataFlag</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set1</span><span class="p">.</span><span class="n">Unions</span><span class="p">();</span>
<span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">MetadataFlag</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set1</span><span class="p">.</span><span class="n">Intersections</span><span class="p">();</span>
<span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">MetadataFlag</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set1</span><span class="p">.</span><span class="n">Exclusions</span><span class="p">();</span>
</pre></div>
</div>
<p>For the most part, you should not need these accessors. They are used
by Parthenon internal functions, such as variable and meshblock
packing, to compute the correct variables to pack.</p>
<p>You can add flags to these property fields with the <code class="docutils literal notranslate"><span class="pre">TakeUnion</span></code>,
<code class="docutils literal notranslate"><span class="pre">TakeIntersection</span></code>, and <code class="docutils literal notranslate"><span class="pre">Exclude</span></code> methods. These methods take
either a standard library container of metadata flags, or another
<code class="docutils literal notranslate"><span class="pre">FlagCollection</span></code> instance. For example, you could write:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">FS_t</span><span class="w"> </span><span class="n">my_set</span><span class="p">;</span>
<span class="n">my_set</span><span class="p">.</span><span class="n">TakeUnion</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">MetadataFlag</span><span class="o">&gt;</span><span class="p">{</span><span class="n">Flag1</span><span class="p">,</span><span class="w"> </span><span class="n">Flag2</span><span class="p">});</span>
<span class="n">my_set</span><span class="p">.</span><span class="n">TakeIntersection</span><span class="p">(</span><span class="n">Flag3</span><span class="p">,</span><span class="w"> </span><span class="n">Flag4</span><span class="p">);</span>
<span class="n">my_set</span><span class="p">.</span><span class="n">Exclude</span><span class="p">(</span><span class="n">Flag5</span><span class="p">,</span><span class="w"> </span><span class="n">Flag6</span><span class="p">);</span>
</pre></div>
</div>
<p>which expresses a desire for particles/fields with EITHER Flag1 or
Flag2 AND Flag3 AND Flag4 and NOT Flag5 or Flag6. Note that these
methods accept standard library containers as well as simple
comma-separated lists.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">FlagCollection</span></code> class supports algebraic operations, although they are
not entirely consistent with standard arithmetic order of
operations. In particular:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// this could also be auto s = set1 || set2;</span>
<span class="k">auto</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">set2</span><span class="p">;</span>
</pre></div>
</div>
<p>produces a set s with the a unions field which is the set union of the
union fields of set1 and set2. However,</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// this could also be s = set1 &amp;&amp; set2;</span>
<span class="k">auto</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">set2</span><span class="p">;</span>
</pre></div>
</div>
<p>Produces a set s with a “unions” field of set1 and an intersections
field containing the original intersections of set1, and the
intersections of set2.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Set1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Set2</span>
</pre></div>
</div>
<p>Produces a set s with the “unions” and “intersections” fields of set1
and an exclusion field containing set1’s exlcusion field as well as
ALL THREE fields (union, intersection, exclusion) contained by set2.</p>
<p>This feels unintuitive, but it makes expressions like</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FS_t</span><span class="p">({</span><span class="n">Flag1</span><span class="p">,</span><span class="w"> </span><span class="n">Flag2</span><span class="p">},</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">FS_t</span><span class="p">({</span><span class="n">Flag3</span><span class="p">,</span><span class="w"> </span><span class="n">Flag4</span><span class="p">})</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FS_t</span><span class="p">({</span><span class="n">Flag5</span><span class="p">,</span><span class="w"> </span><span class="n">Flag6</span><span class="p">})</span>
</pre></div>
</div>
<p>behave in an intuitive way. This translates to a desire for
particles/fields with EITHER Flag1 or Flag2 AND Flag3 AND Flag4 and
NOT Flag5 or Flag6.</p>
<p>When in doubt about arithmetic with FlagCollections, aggressively use
parenthesis to enforce the order of operations you expect.</p>
<p>Note that the unary inverse operator is <strong>not</strong> supported.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="containers.html" class="btn btn-neutral float-left" title="Containers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="refinement_operations.html" class="btn btn-neutral float-right" title="Prolongation and Restriction Operations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Parthenon Collaboration and Triad National Security.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: develop
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="metadata.html">develop</a></dd>
      <dd><a href="../../../acreyes/div-free-prolong/src/interface/metadata.html">acreyes/div-free-prolong</a></dd>
      <dd><a href="../../../acreyes/edge-flux-pack/src/interface/metadata.html">acreyes/edge-flux-pack</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>